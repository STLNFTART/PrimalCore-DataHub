version: "3.9"
name: primal-db-stack

services:
  redis:
    image: docker.io/library/redis:7
    container_name: primal_redis
    command: ["redis-server","--requirepass","${REDIS_PASSWORD}"]
    ports: ["6379:6379"]
    volumes: ["./volumes/redis:/data"]
    restart: unless-stopped
    healthcheck:
      test: ["CMD","redis-cli","-a","${REDIS_PASSWORD}","ping"]
      interval: 10s
      timeout: 3s
      retries: 5

  timescaledb:
    image: docker.io/timescale/timescaledb:latest-pg16
    container_name: primal_timescaledb
    environment:
      POSTGRES_PASSWORD: "${POSTGRES_PASSWORD}"
    ports: ["5433:5432"]
    volumes: ["./volumes/timescaledb:/var/lib/postgresql/data"]
    restart: unless-stopped
    healthcheck:
      test: ["CMD","pg_isready","-U","postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  influxdb:
    image: docker.io/library/influxdb:2.7
    container_name: primal_influxdb
    ports: ["8086:8086"]
    volumes: ["./volumes/influx:/var/lib/influxdb2"]
    restart: unless-stopped
    healthcheck:
      test: ["CMD","curl","-f","http://localhost:8086/health"]
      interval: 10s
      timeout: 5s
      retries: 5

  neo4j:
    image: docker.io/library/neo4j:5
    container_name: primal_neo4j
    environment:
      NEO4J_AUTH: "${NEO4J_AUTH}"
    ports: ["7474:7474","7687:7687"]
    volumes:
      - "./volumes/neo4j/data:/data"
      - "./volumes/neo4j/logs:/logs"
    restart: unless-stopped
    healthcheck:
      test: ["CMD","curl","-f","http://localhost:7474"]
      interval: 10s
      timeout: 5s
      retries: 5

  clickhouse:
    image: docker.io/clickhouse/clickhouse-server:24.8
    container_name: primal_clickhouse
    ports: ["8123:8123","9009:9009"]
    volumes: ["./volumes/clickhouse:/var/lib/clickhouse"]
    restart: unless-stopped
    healthcheck:
      test: ["CMD","wget","--spider","-q","http://localhost:8123/ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  qdrant:
    image: docker.io/qdrant/qdrant:latest
    container_name: primal_qdrant
    ports: ["6333:6333"]
    volumes: ["./volumes/qdrant:/qdrant/storage"]
    restart: unless-stopped
    healthcheck:
      test: ["CMD","curl","-f","http://localhost:6333/health"]
      interval: 10s
      timeout: 5s
      retries: 5
